<!-- events/templates/events/event_detail.html -->
{% extends 'events/base.html' %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- left: details -->
  <div class="md:col-span-2 bg-white p-6 rounded-xl shadow">
    <h1 class="text-2xl font-bold">{{ event.title }}</h1>
    <p class="text-sm text-gray-500 mt-1">{{ event.location }}</p>
    <p class="text-sm text-gray-500 mt-1">{{ event.start_time|date:"M d, Y H:i" }}{% if event.end_time %} - {{ event.end_time|date:"M d, Y H:i" }}{% endif %}</p>

    <div class="mt-4 prose max-w-none">
      <p>{{ event.description|linebreaks }}</p>
    </div>
  </div>

  <!-- right: register -->
  <aside class="bg-white p-6 rounded-xl shadow">
    <h2 class="text-lg font-semibold">Register</h2>

    {% if success %}
      <div class="mt-3 p-3 bg-green-50 text-green-800 rounded">Thanks â€” you're registered!</div>
    {% endif %}

    <!-- Server-side form (works out-of-the-box) -->
    <form method="post" class="mt-3 space-y-3">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div>
        {{ form.name.label_tag }}
        {{ form.name }}
        {{ form.name.errors }}
      </div>
      <div>
        {{ form.email.label_tag }}
        {{ form.email }}
        {{ form.email.errors }}
      </div>
      <button type="submit" class="w-full mt-2 inline-block px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Register</button>
    </form>

    <hr class="my-4">

    <!-- Optional: Quick AJAX register (uses API) -->
    <div class="text-sm text-gray-600">Or register quickly without reload:</div>
    <div class="mt-3 space-y-2">
      <input id="ajax-name" class="w-full px-3 py-2 border rounded" placeholder="Your name">
      <input id="ajax-email" class="w-full px-3 py-2 border rounded" placeholder="you@example.com">
      <button id="ajax-register" class="w-full inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Register (AJAX)</button>
      <div id="ajax-msg" class="text-sm mt-2"></div>
    </div>

    <script>
      document.getElementById('ajax-register').addEventListener('click', async function(){
        const name = document.getElementById('ajax-name').value.trim();
        const email = document.getElementById('ajax-email').value.trim();
        const msg = document.getElementById('ajax-msg');
        msg.textContent = '';
        if (!name || !email) { msg.textContent = 'Name and email required'; return; }

        try {
          const res = await fetch("{% url 'events:api_register' event.pk %}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({name, email})
          });
          const data = await res.json();
          if (data.success) {
            msg.textContent = "Registered! id: " + data.registration_id;
            msg.style.color = "green";
          } else {
            msg.textContent = data.error || "Error";
            msg.style.color = "red";
          }
        } catch (err) {
          msg.textContent = "Network error";
          msg.style.color = "red";
        }
      });
    </script>

  </aside>
</div>
{% endblock %}

